#######################################################################
# $Header$
#######################################################################

prefix      = @prefix@
exec_prefix = @exec_prefix@
srcdir      = @ROOT_DIR@

##############################################################################
# Compiler and system configuration
##############################################################################

SHELL       = /bin/sh
CC          = @CC@
CFLAGS      = @CFLAGS@
CXX         = @CXX@
LIBS        = @LIBS@
AR          = @AR@
RANLIB      = @RANLIB@

SWIG_LIB    = $(prefix)/lib/swig1.3
BIN_DIR     = $(exec_prefix)/bin
LIB_DIR     = $(exec_prefix)/lib
TARGET      = swig
SOURCE      = Source
SOURCEDIRS  = `ls $(SOURCE)`

swig: SWIG1.1 Modules1.1 Swig Preprocessor DOH
	$(CXX) -o $(TARGET) \
	$(SOURCE)/Modules1.1/libmodules11.a \
	$(SOURCE)/SWIG1.1/libswig11.a \
	$(SOURCE)/Preprocessor/libcpp.a \
	$(SOURCE)/Swig/libswig.a \
	$(SOURCE)/DOH/libdoh.a \
	$(LIBS)

experiment: Swig Preprocessor LParse Experiment Swim SWILL DOH
	$(CXX) -o $(TARGET) \
	$(SOURCE)/Experiment/libexp.a \
	$(SOURCE)/Xmlparse/libxmlparse.a \
	$(SOURCE)/Expat/libexpat.a \
	$(SOURCE)/LParse/liblparse.a \
	$(SOURCE)/Preprocessor/libcpp.a \
	$(SOURCE)/Swig/libswig.a \
	$(SOURCE)/Swim/libswim.a \
	$(SOURCE)/SWILL/libswill.a \
	$(SOURCE)/DOH/libdoh.a \
	$(LIBS)

SWIG1.1:
	@cd $(SOURCE)/SWIG1.1; $(MAKE)

Modules1.1:
	@cd $(SOURCE)/Modules1.1; $(MAKE)

Swig:
	@cd $(SOURCE)/Swig; $(MAKE)

Preprocessor: 
	@cd $(SOURCE)/Preprocessor; $(MAKE)

LParse:
	@cd $(SOURCE)/LParse; $(MAKE)

Experiment:
	@cd $(SOURCE)/Experiment; $(MAKE)

Swim:
	@cd $(SOURCE)/Swim; $(MAKE)

SWILL:
	@cd $(SOURCE)/SWILL; $(MAKE)

DOH:
	@cd $(SOURCE)/DOH; $(MAKE)

#####################################################################
# Runtime libraries
#####################################################################

runtime:
	@cd Runtime; $(MAKE)

#####################################################################
# CLEAN
#####################################################################

clean:
	@for i in `ls $(SOURCE)`; \
	do \
	   if [ -d $(SOURCE)/$$i -a -f $(SOURCE)/$$i/Makefile ]; then \
		cd $(SOURCE)/$$i; $(MAKE) clean; cd $(srcdir); \
	   fi \
	done;
	@cd Runtime; $(MAKE) clean
	rm -f swig

 
#####################################################################
# TARGETS: install & friends
#####################################################################

INSTALL        = ./install-sh -c
INSTALL_DATA   = ${INSTALL} -m 644
INSTALL_PROGRAM= ${INSTALL} -m 755

install: install-main install-lib install-runtime
	@echo "Installation complete"

install-main:
	@for i in $(LIB_DIR) $(BIN_DIR); \
	do \
	  if [ ! -d $$i ] ; then \
	         mkdir $$i; \
                 echo "Making directory $$i"; \
                 chmod 755 $$i;\
                 else true; \
             fi; \
            done;
	@echo "Installing $(BIN_DIR)/swig"
	@$(INSTALL_PROGRAM) swig $(BIN_DIR)/swig

install-lib:
	@for i in $(SWIG_LIB) ; \
	do \
	  if [ ! -d $$i ] ; then \
	         mkdir $$i; \
                 echo "Making directory $$i"; \
                 chmod 755 $$i;\
                 else true; \
             fi; \
            done;
	@echo "Installing the SWIG library"
#	cd $(SWIG_LIB); rm -rf *
	@for i in $(SWIG_LIB)/tcl $(SWIG_LIB)/perl5 $(SWIG_LIB)/python $(SWIG_LIB)/guile ; \
	do \
	  if [ ! -d $$i ] ; then \
	         mkdir $$i; \
                 echo "Making directory $$i"; \
                 chmod 755 $$i;\
                 else true; \
             fi; \
            done;
	@cd Lib; for i in *.i *.swg; \
	    do \
	    echo "Installing Lib/$$i"; \
            ../$(INSTALL_DATA) $$i $(SWIG_LIB)/$$i; \
	    done;
	@cd Lib/tcl; for i in *.i *.swg; \
	    do \
	    echo "Installing Lib/tcl/$$i"; \
            ../../$(INSTALL_DATA) $$i $(SWIG_LIB)/tcl/$$i; \
	    done;
	@cd Lib/perl5; for i in *.i *.swg Makefile.pl; \
	    do \
	    echo "Installing Lib/perl5/$$i"; \
            ../../$(INSTALL_DATA) $$i $(SWIG_LIB)/perl5/$$i; \
	    done;
	@cd Lib/python; for i in *.i *.swg; \
	    do \
	    echo "Installing Lib/python/$$i"; \
            ../../$(INSTALL_DATA) $$i $(SWIG_LIB)/python/$$i; \
	    done;
	@cd Lib/guile; for i in *.i *.swg; \
	    do \
	    echo "Installing Lib/guile/$$i"; \
            ../../$(INSTALL_DATA) $$i $(SWIG_LIB)/guile/$$i; \
	    done;

install-runtime:
	@cd Runtime; $(MAKE) install
