# Makefile for producing SWIG runtime libraries.
#
# The runtime libraries contain the pointer-type checking code and other
# support functions that are needed when creating multi-file SWIG modules.
#
# At the moment, libtool is used to create these libraries

prefix      = @prefix@
exec_prefix = @exec_prefix@
srcdir      = @srcdir@
VPATH       = @srcdir@

CC          = @CC@
LIBTOOL     = ../Tools/libtool
SWIGLIB     = ../Lib
LIBS        = libswigpl.la libswigpy.la libswigtcl8.la libswigrb.la
LIB_DIR     = $(exec_prefix)/lib

all:
	@sh $(srcdir)/make.sh


install:
	@echo "Installing runtime libraries"
	@for i in $(LIBS); \
	do \
	if [ -f $$i ]; then \
	   $(LIBTOOL) install -c $$i $(LIB_DIR)/$$i; \
        fi; \
	done;

clean::
	rm -rf *.o *.lo *.la *.a *.c *.swg *~ core .libs

# ----------------------------------------------------------------------
# Tcl runtime library
# ----------------------------------------------------------------------

TCL_INCLUDE = @TCLINCLUDE@
TCL_RUNTIME = $(SWIGLIB)/tcl/swigtcl8.swg
# Tcl 8.x

tcl: libswigtcl8.la

libswigtcl8.la:
	-cp $(srcdir)/$(TCL_RUNTIME) swigtcl8.c
	$(LIBTOOL) $(CC) -c $(TCL_INCLUDE) -DSWIG_GLOBAL swigtcl8.c
	$(LIBTOOL) $(CC) -o libswigtcl8.la swigtcl8.lo -rpath $(LIB_DIR) -avoid-version

# ----------------------------------------------------------------------
# Python run-time library
# ----------------------------------------------------------------------

PYTHON_INCLUDE = -DHAVE_CONFIG_H @PYINCLUDE@
PYTHON_RUNTIME = $(SWIGLIB)/python/python.swg

# Python shared

python: libswigpy.la

libswigpy.la:
	-cp $(srcdir)/$(PYTHON_RUNTIME) libpy.c
	$(LIBTOOL) $(CC) -c $(PYTHON_INCLUDE) -DSWIG_GLOBAL libpy.c
	$(LIBTOOL) $(CC) -o libswigpy.la libpy.lo -rpath $(LIB_DIR) -avoid-version

# ----------------------------------------------------------------------
# Perl run-time library
# ----------------------------------------------------------------------

PERL5_INCLUDE = -I@PERL5EXT@
PERL5_RUNTIME = $(SWIGLIB)/perl5/perl5.swg

# Perl shared

perl5: libswigpl.la

libswigpl.la:
	@rm -f libperl.c
	cat $(srcdir)/perlrun.h >> libperl.c
	cat $(srcdir)/$(PERL5_RUNTIME) >> libperl.c
	$(LIBTOOL) $(CC) -c $(PERL5_INCLUDE) -DSWIG_GLOBAL -Dbool=char -Dexplicit= libperl.c
	$(LIBTOOL) $(CC) -o libswigpl.la libperl.lo -rpath $(LIB_DIR) -avoid-version

# ----------------------------------------------------------------------
# Ruby run-time library
# ----------------------------------------------------------------------

RUBY_INCLUDE = @RUBYINCLUDE@
RUBY_RUNTIME = $(SWIGLIB)/ruby/ruby.swg

# Ruby shared

ruby: libswigrb.la

libswigrb.la:
	cp $(srcdir)/$(RUBY_RUNTIME) librb.c
	cat $(SWIGLIB)/ruby/rubydef.swg >> librb.c
	$(LIBTOOL) $(CC) -c $(RUBY_INCLUDE) -DSWIG_GLOBAL librb.c
	$(LIBTOOL) $(CC) -o libswigrb.la librb.lo -rpath $(LIB_DIR) -avoid-version
