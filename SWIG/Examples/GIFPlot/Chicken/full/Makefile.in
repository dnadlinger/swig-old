@SET_MAKE@

srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@
SOURCE_DIR = $(top_srcdir)/Examples/GIFPlot/Chicken/full
TOP        = ../../..
CC         = @CC@
CXX        = @CXX@
OBJEXT     = @OBJEXT@
EXEEXT     = @EXEEXT@
SWIG       = $(TOP)/../swig$(EXEEXT)
CHICKGEN   = gifplot_wrap.$(OBJEXT) csi.$(OBJEXT) precsi.$(OBJEXT) \
		ogifplot.$(OBJEXT) 
CHICKSRC   = csi.c precsi.c ogifplot.c
SRCS       = $(CHICKGEN)
TARGET     = gifplot$(EXEEXT)
INCLUDE    = -I$(SOURCE_DIR) -I../../Include
LIBS       = -L../.. -lgifplot -lm
SWIGOPT    = -I../../Include

all:: $(TARGET)

.SUFFIXES: .cxx

.c.o:
	$(CC) $(INCLUDE) $(CFLAGS) -c -o $*.o $<

.cxx.o:
	$(CXX) $(INCLUDE) $(CFLAGS) -c -o $*.o $<

csi.c:
	$(MAKE) -f $(TOP)/Makefile TARGET='csi.c' \
		INTERFACE='precsi' chicken_csi

precsi.c: $(SOURCE_DIR)/precsi.scm
	$(MAKE) -f $(TOP)/Makefile TARGET='precsi.c' \
		INTERFACE='$<' chicken

gifplot_wrap.c gifplot.scm: $(SOURCE_DIR)/gifplot.i
	(test $< -nt gifplot.i && cp -p $< gifplot.i) || echo gifplot.i is up-to-date
	$(MAKE) -f $(TOP)/Makefile SWIG='$(SWIG)' SWIGOPT='$(SWIGOPT)' \
		INCLUDE='$(INCLUDE)' INTERFACE='gifplot.i' chicken_c

ogifplot.c: gifplot.scm
	$(MAKE) -f $(TOP)/Makefile TARGET='ogifplot.c' \
		INTERFACE='$<' chicken

$(TARGET): $(SRCS)
	$(MAKE) -f $(TOP)/Makefile SRCS='$(SRCS)' SWIG='$(SWIG)' \
		INCLUDE='$(INCLUDE)' SWIGOPT='$(SWIGOPT)' TARGET='$(TARGET)' \
		LIBS='$(LIBS)' INTERFACE='$(INTERFACE)' chicken_static

clean::
	rm -f *_wrap* *.$(OBJEXT) core *~ *.so *.stackdump STACKTRACE
	rm -f $(CHICKGEN) $(CHICKSRC)
	rm -f gifplot.scm
	rm -f $(TARGET)
	rm -f *.gif

check: all
